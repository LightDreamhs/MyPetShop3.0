# 极简部署配置（无Nginx）
# Spring Boot 直接提供前端静态文件和API

server:
  port: 80  # 直接监听80端口
  servlet:
    context-path: /api/v1
  compression:
    enabled: true
    mime-types: text/html,text/xml,text/plain,text/css,application/javascript,application/json

spring:
  application:
    name: pet-shop-backend

  # 数据源配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/pet_shop_3_0?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: petshop
    password: ${SPRING_DATASOURCE_PASSWORD}
    hikari:
      minimum-idle: 2
      maximum-pool-size: 10
      idle-timeout: 30000

  # 文件上传
  servlet:
    multipart:
      enabled: true
      max-file-size: 5MB
      max-request-size: 10MB

  # 静态资源配置
  web:
    resources:
      static-locations: classpath:/static/

  # Jackson
  jackson:
    time-zone: GMT+8
    date-format: yyyy-MM-dd HH:mm:ss
    default-property-inclusion: non_null

# MyBatis
mybatis:
  mapper-locations: classpath:mapper/**/*.xml
  type-aliases-package: com.petshop.backend.entity
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: false
    call-setters-on-nulls: true
    jdbc-type-for-null: 'null'
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl

# JWT
jwt:
  secret: ${JWT_SECRET:defaultSecretKey}
  expiration: ${JWT_EXPIRATION:7200}

# 文件上传（关键配置）
file:
  upload-dir: ${FILE_UPLOAD_DIR:/opt/petshop/uploads}
  # 极简部署：服务器域名，不包含 /api/v1
  # 返回格式: http://your-domain/uploads/images/xxx.jpg
  server-domain: ${FILE_SERVERDOMAIN:http://localhost}

# 日志
logging:
  level:
    root: INFO
    com.petshop.backend: INFO
    com.petshop.backend.mapper: WARN
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n'
